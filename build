#!/usr/bin/env ruby
require 'yaml'
require "nokogiri"


def third_level(m, item)
  m.ul {
    item.each do |sub|
      m.li {
        m.a(:href => sub['link']) {
          m.text sub['label']
        }
      }
    end
  }
end

# Format a second-level menu item
def second_level(m, item)
  m.ul {
    item.each do |sub|
      m.li {
        if sub['menu'].nil?
          m.a(:href => sub['link']) {
            m.text sub['label']
          }
        else
          m.h5 {
            m.text sub['label']
          }
          
          third_level(m, sub['menu'])
        end
      }
    end
  }
end

# Format a top-level menu item
def top_level(m, item)
  item_attr = {}
  if ! item['menu'].nil?
    item_attr[:class] = 'dropDown'
  end
  m.li(item_attr) {
    m.a(:href=> item['link']) { 
      m.text item['label']
    }
    if ! item['menu'].nil?
      m.div.dropDownContent {
        second_level(m, item['menu'])
      }
    end
  }
end

header = YAML.load_file('header.yml')

@menu = Nokogiri::HTML::DocumentFragment.parse ""

Nokogiri::HTML::Builder.with(@menu) do |m|
  m.div(:class => 'nav-wrapper') {
    m.div(:class => 'primary-links') {
      m.ul {
        header['menu'].each do |item|
          top_level(m, item)
        end
      }
    }
  }
end

puts @menu.to_html
